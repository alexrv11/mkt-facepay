/* global document */
const React = require('react');
const PropTypes = require('prop-types');
const { createPortal } = require('react-dom');
const { canUseDOM } = require('exenv');

class Portal extends React.Component {
  componentWillUnmount() {
    if (this.defaultNode) {
      document.body.removeChild(this.defaultNode);
    }
    this.defaultNode = null;
  }

  render() {
    if (!canUseDOM) {
      return null;
    }
    if (!this.defaultNode) {
      this.defaultNode = document.createElement('div');
      this.defaultNode.className = this.props.className;
      document.body.appendChild(this.defaultNode);
    }
    return createPortal(
      this.props.children,
      this.defaultNode,
    );
  }
}

Portal.propTypes = {
  children: PropTypes.node.isRequired,
  className: PropTypes.string,
};

Portal.defaultProps = {
  className: '',
};

module.exports = Portal;
